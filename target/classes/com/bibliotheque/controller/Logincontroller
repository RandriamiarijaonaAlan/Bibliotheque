package com.bibliotheque.controller;

import com.bibliotheque.entity.Profil;
import com.bibliotheque.repository.ProfilRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.Optional;

@Controller
public class LoginController {

    @Autowired
    private ProfilRepository profilRepository;

    @GetMapping("/login")
    public String showLoginForm() {
        return "login";  // nom du template Thymeleaf (login.html)
    }

    @PostMapping("/login")
    public String login(
            @RequestParam("email") String email,
            @RequestParam("motDePasse") String motDePasse,
            Model model
    ) {
        Optional<Profil> optionalProfil = profilRepository.findByEmail(email);

        if (optionalProfil.isPresent()) {
            Profil profil = optionalProfil.get();

            // Simple comparaison mot de passe en clair (à remplacer par un hash dans prod)
            if (profil.getMotDePasse().equals(motDePasse)) {
                // Login OK
                // Ici tu peux enregistrer l'utilisateur en session etc.
                return "redirect:/";  // redirection vers la page d’accueil
            }
        }

        // En cas d’erreur
        model.addAttribute("error", "Email ou mot de passe incorrect");
        return "login";
    }
}
